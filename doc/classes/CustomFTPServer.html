<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CustomFTPServer</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CustomFTPServer</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/custom-ftp-server_rb.html">
                lib/custom-ftp-server.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000008">bad_command</a>&nbsp;&nbsp;
      <a href="#M000004">handler</a>&nbsp;&nbsp;
      <a href="#M000006">kill_dead_connections</a>&nbsp;&nbsp;
      <a href="#M000001">new</a>&nbsp;&nbsp;
      <a href="#M000003">new_connection_thread</a>&nbsp;&nbsp;
      <a href="#M000010">output_version</a>&nbsp;&nbsp;
      <a href="#M000009">parse_options</a>&nbsp;&nbsp;
      <a href="#M000013">real_folder</a>&nbsp;&nbsp;
      <a href="#M000005">response</a>&nbsp;&nbsp;
      <a href="#M000002">run</a>&nbsp;&nbsp;
      <a href="#M000011">send_data</a>&nbsp;&nbsp;
      <a href="#M000007">thread</a>&nbsp;&nbsp;
      <a href="#M000012">virtual_folder</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="CustomFTPServerFunctions.html">CustomFTPServerFunctions</a></span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">VERSION</td>
          <td>=</td>
          <td class="context-item-value">'0.1.4'</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">
          <a href="#M000001" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(arguments)</span>
          </a>
        </div>
      
        <div class="method-description">
          <h2>Creates a <a href="CustomFTPServer.html">CustomFTPServer</a></h2>
<pre>
  This will create a new CustomFTPServer Object and will make start a TCPServer
  It does not start a loop for listening though, this must be done using CustomFTPServer.run()

  It sets up some default options, and calls the functions needed to set the chosen ones and will move to the &quot;root&quot; directory chosen
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000001-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000001-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 52</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">arguments</span>)
    <span class="ruby-ivar">@arguments</span> = <span class="ruby-identifier">arguments</span>
    
    <span class="ruby-comment cmt"># Set defaults</span>
    <span class="ruby-ivar">@options</span> = <span class="ruby-constant">OpenStruct</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">host</span> = <span class="ruby-value str">&quot;127.0.0.1&quot;</span>
    <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">port</span> = <span class="ruby-value">21</span>
    <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">root</span> = <span class="ruby-value str">&quot;/&quot;</span>
    
    <span class="ruby-comment cmt"># Set custom options</span>
    <span class="ruby-identifier">parse_options</span>
    
    <span class="ruby-comment cmt"># Setup Exit Shortcut</span>
    <span class="ruby-comment cmt">#trap('INT') { puts &quot;\n\nShutting down server...&quot;; @status = :dead; Thread.exit }</span>
    
    <span class="ruby-comment cmt"># Start a server</span>
    <span class="ruby-keyword kw">begin</span>
      <span class="ruby-ivar">@server</span> = <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@options</span>.<span class="ruby-identifier">host</span>, <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">port</span>)
    <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EADDRINUSE</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;The address is already in use&quot;</span>
      <span class="ruby-identifier">exit</span>(<span class="ruby-value">0</span>)
    <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EACCES</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;The port is already in use&quot;</span>
      <span class="ruby-identifier">exit</span>(<span class="ruby-value">0</span>)
    <span class="ruby-keyword kw">end</span>
    
    <span class="ruby-comment cmt"># Choose a root</span>
    <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-ivar">@options</span>.<span class="ruby-identifier">root</span>)
    
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">
          <a href="#M000002" class="method-signature">
          <span class="method-name">run</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <h2>The server loop</h2>
<pre>
  This functions starts up the loop to accept incomming connections and threads, it also calls a function that starts up thread management that will make sure threads don't just sit open when they're not being used.
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 86</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run</span>
    
    <span class="ruby-comment cmt"># Explain how to shut down server</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Server starting up...\n&quot;</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;To shut down server press ctrl+c&quot;</span>
    
    <span class="ruby-ivar">@status</span> = <span class="ruby-identifier">:alive</span>
    <span class="ruby-ivar">@threads</span> = []
    
    <span class="ruby-identifier">kill_dead_connections</span>
    
    <span class="ruby-keyword kw">while</span> (<span class="ruby-ivar">@status</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:alive</span>)
      
        <span class="ruby-keyword kw">begin</span>
          <span class="ruby-identifier">session</span> = <span class="ruby-ivar">@server</span>.<span class="ruby-identifier">accept</span>
          <span class="ruby-ivar">@threads</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_connection_thread</span>(<span class="ruby-identifier">session</span>)
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Interrupt</span>
          <span class="ruby-ivar">@status</span> = <span class="ruby-identifier">:dead</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;\n\nShutting down server...&quot;</span>
        <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>
          <span class="ruby-ivar">@status</span> = <span class="ruby-identifier">:dead</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{ex.class}: #{ex.message} - \n\t#{ex.backtrace[0]}&quot;</span>
          <span class="ruby-identifier">exit</span>(<span class="ruby-value">0</span>)
        <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">end</span>
      
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">bad_command</span><span class="method-args">(name, *params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Command not understood
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 194</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bad_command</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">params</span>)
      <span class="ruby-value str">&quot;502 Command not implemented&quot;</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">
          <a href="#M000004" class="method-signature">
          <span class="method-name">handler</span><span class="method-args">(request)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call commands and return the <a
href="CustomFTPServer.html#M000005">response</a> to the client
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 140</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">handler</span>(<span class="ruby-identifier">request</span>)
      <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:stamp</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>
      
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">command</span> = <span class="ruby-identifier">request</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">strip</span>
        <span class="ruby-identifier">rqarray</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">' '</span>)
        <span class="ruby-identifier">message</span> = <span class="ruby-identifier">rqarray</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">rqarray</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">rqarray</span>.<span class="ruby-identifier">length</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">rqarray</span>[<span class="ruby-value">1</span>]
        <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">command</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-operator">*</span><span class="ruby-constant">COMMANDS</span>
            <span class="ruby-identifier">__send__</span> <span class="ruby-identifier">command</span>, <span class="ruby-identifier">message</span>
          <span class="ruby-keyword kw">when</span> <span class="ruby-operator">*</span><span class="ruby-constant">PATHCOMMANDS</span>
            <span class="ruby-identifier">__send__</span> <span class="ruby-identifier">command</span>, <span class="ruby-identifier">real_folder</span>(<span class="ruby-identifier">message</span>)
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">bad_command</span> <span class="ruby-identifier">command</span>, <span class="ruby-identifier">message</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EACCES</span>, <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPERM</span>
        <span class="ruby-value str">&quot;553 Permission denied&quot;</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
        <span class="ruby-value str">&quot;553 File doesn't exist&quot;</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
        <span class="ruby-node">&quot;500 Server Error: #{e.class}: #{e.message} - \n\t#{e.backtrace[0]}&quot;</span>
      <span class="ruby-keyword kw">end</span>
      
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">kill_dead_connections</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Periodically kill inactive connections
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 174</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">kill_dead_connections</span>
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span>
        <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
          <span class="ruby-ivar">@threads</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">t</span>[<span class="ruby-identifier">:stamp</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">400</span>
              <span class="ruby-identifier">t</span>[<span class="ruby-identifier">:session</span>].<span class="ruby-identifier">close</span>
              <span class="ruby-identifier">t</span>.<span class="ruby-identifier">kill</span>
              <span class="ruby-identifier">debug</span> <span class="ruby-value str">&quot;Killed inactive connection.&quot;</span>
              <span class="ruby-keyword kw">true</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">sleep</span> <span class="ruby-value">20</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>    
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">
          <a href="#M000003" class="method-signature">
          <span class="method-name">new_connection_thread</span><span class="method-args">(session)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="CustomFTPServer.html#M000001">new</a> <a
href="CustomFTPServer.html#M000007">thread</a> for people to work on
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 118</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_connection_thread</span>(<span class="ruby-identifier">session</span>)
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">session</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">session</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:session</span>] = <span class="ruby-identifier">session</span>
        <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:mode</span>] = <span class="ruby-identifier">:binary</span>
        <span class="ruby-identifier">client_info</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">peeraddr</span>
        <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:addr</span>] = [<span class="ruby-identifier">client_info</span>[<span class="ruby-value">1</span>], <span class="ruby-identifier">client_info</span>[<span class="ruby-value">3</span>]]
        <span class="ruby-identifier">response</span> <span class="ruby-value str">&quot;220 Connection Established&quot;</span>
        
        <span class="ruby-comment cmt"># listen for commands</span>
        <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">closed?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Command start&quot;</span>
          <span class="ruby-identifier">request</span> = <span class="ruby-identifier">session</span>.<span class="ruby-identifier">gets</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{request}&quot;</span>
          <span class="ruby-identifier">reply</span> = <span class="ruby-identifier">handler</span>(<span class="ruby-identifier">request</span>)
          <span class="ruby-identifier">puts</span> <span class="ruby-identifier">reply</span>
          <span class="ruby-identifier">response</span> <span class="ruby-identifier">reply</span>
        <span class="ruby-keyword kw">end</span>
        
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">output_version</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
When using option -v or &#8212;version, this will output the current
version
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 214</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">output_version</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{File.basename(__FILE__)} version #{VERSION}&quot;</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">parse_options</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Parse the option passed through the command line
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 199</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_options</span>
      
      <span class="ruby-comment cmt"># Specify options</span>
      <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OptionParser</span>.<span class="ruby-identifier">new</span> 
      <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'-v'</span>, <span class="ruby-value str">'--version'</span>)    { <span class="ruby-identifier">output_version</span>; <span class="ruby-identifier">exit</span> <span class="ruby-value">0</span> }
      <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--host HOST'</span>)        { <span class="ruby-operator">|</span><span class="ruby-identifier">host</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">host</span> = <span class="ruby-identifier">host</span>; }
      <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--port PORT'</span>)        { <span class="ruby-operator">|</span><span class="ruby-identifier">port</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">port</span> = <span class="ruby-identifier">port</span>; }
      <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--root ROOT'</span>)        { <span class="ruby-operator">|</span><span class="ruby-identifier">root</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">root</span> = <span class="ruby-identifier">root</span>; }
            
      <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">parse!</span>(<span class="ruby-ivar">@arguments</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
      
      <span class="ruby-keyword kw">true</span>      
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">real_folder</span><span class="method-args">(folder)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Find real folder
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 256</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">real_folder</span>(<span class="ruby-identifier">folder</span>)
      <span class="ruby-identifier">f_array</span> = (<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">folder</span>).<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;/&quot;</span>)
      <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">folder</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;/&quot;</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">folder</span>
      <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
        <span class="ruby-identifier">f_array</span> = <span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> }
        <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;/&quot;</span>)
      <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">folder</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;/&quot;</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">root</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">folder</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">response</span><span class="method-args">(msg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Send data back to the client
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 167</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">response</span>(<span class="ruby-identifier">msg</span>)
      <span class="ruby-identifier">session</span> = <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:session</span>]
      <span class="ruby-identifier">session</span>.<span class="ruby-identifier">print</span> <span class="ruby-identifier">msg</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">LNBR</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">closed?</span>
      <span class="ruby-identifier">session</span>.<span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;500 Server Error&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">send_data</span><span class="method-args">(data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Send data over a connection
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 219</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_data</span>(<span class="ruby-identifier">data</span>)
      <span class="ruby-identifier">bytes</span> = <span class="ruby-value">0</span>
      <span class="ruby-keyword kw">begin</span>
        <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:mode</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:binary</span>
            <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:datasocket</span>].<span class="ruby-identifier">syswrite</span>(<span class="ruby-identifier">line</span>)
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">puts</span> <span class="ruby-identifier">line</span>
            <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:datasocket</span>].<span class="ruby-identifier">send</span>(<span class="ruby-identifier">line</span>, <span class="ruby-value">0</span>)
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">bytes</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">length</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPIPE</span> 
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">quit</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-comment cmt"># do nothing</span>
      <span class="ruby-keyword kw">ensure</span>
        <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:datasocket</span>].<span class="ruby-identifier">close</span>
        <span class="ruby-identifier">thread</span>[<span class="ruby-identifier">:datasocket</span>] = <span class="ruby-keyword kw">nil</span> 
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">bytes</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">thread</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns current <a href="CustomFTPServer.html#M000007">thread</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 191</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">thread</span>; <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>; <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">virtual_folder</span><span class="method-args">(folder)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Create virtual folder string
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
<span class="ruby-comment cmt"># File lib/custom-ftp-server.rb, line 243</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">virtual_folder</span>(<span class="ruby-identifier">folder</span>)
      <span class="ruby-identifier">f_array</span> = (<span class="ruby-identifier">folder</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-ivar">@options</span>.<span class="ruby-identifier">root</span>, <span class="ruby-value str">&quot;&quot;</span>)).<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;/&quot;</span>)
      <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
        <span class="ruby-identifier">f_array</span> = <span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span> }
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;/&quot;</span>)
      <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">f_array</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;/&quot;</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">folder</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>